<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Сканер штрих-кодів</title>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div id="reader" style="width: 600px; display: none;"></div>
    <p id="result"></p>
    <button onclick="startScanner()">Запустити сканер</button>
    <button onclick="stopScanner()" style="display: none;" id="stopButton">Зупинити сканер</button>

    <script>
        const html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", { fps: 10, qrbox: 250 });
        let scannerRunning = false;

        function onScanSuccess(decodedText, decodedResult) {
            if (!scannerRunning) return;
            scannerRunning = false;
            document.getElementById("result").innerHTML = `Знайдено штрих-код: ${decodedText}`;
            document.getElementById("reader").style.display = "none";
            document.getElementById("stopButton").style.display = "none";
            html5QrcodeScanner.clear();

            // Відправка результату в Telegram через WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.sendData(decodedText);
                window.Telegram.WebApp.close();
            } else {
                alert("Не вдалося відправити дані в Telegram. Використовуйте Telegram WebApp.");
            }
        }

        function startScanner() {
            if (!scannerRunning) {
                document.getElementById("reader").style.display = "block";
                document.getElementById("stopButton").style.display = "inline";
                html5QrcodeScanner.render(onScanSuccess);
                scannerRunning = true;
            }
        }

        function stopScanner() {
            if (scannerRunning) {
                html5QrcodeScanner.clear();
                scannerRunning = false;
                document.getElementById("reader").style.display = "none";
                document.getElementById("stopButton").style.display = "none";
                document.getElementById("result").innerHTML = "Сканер зупинено.";
            }
        }

        // Ініціалізація Telegram WebApp
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
        }
    </script>
</body>
</html>
